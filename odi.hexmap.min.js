/**
	ODI Leeds hex map in SVG
	Version 0.5.3
 */
!function(t){var e=t.ODI||{};function i(t,i){if(this.version="0.5.3",i||(i={}),this._attr=i,this.title="ODI HexMap",this.logging=location.search.indexOf("debug=true")>=0,this.log=function(){if(this.logging||"ERROR"==arguments[0]||"WARNING"==arguments[0]){var t=Array.prototype.slice.call(arguments,0),e=["%c"+this.title+"%c: "+t[1],"font-weight:bold;",""];t.length>2&&(e=e.concat(t.splice(2))),console&&"function"==typeof console.log&&("ERROR"==arguments[0]?console.error.apply(null,e):"WARNING"==arguments[0]?console.warn.apply(null,e):"INFO"==arguments[0]?console.info.apply(null,e):console.log.apply(null,e))}return this},!t)return this.log("ERROR","Unable to find the element to draw into",t),{};i.label||(i.label={}),i.grid||(i.grid={}),"boolean"!=typeof i.label.show&&(i.label.show=!1),"boolean"!=typeof i.label.clip&&(i.label.clip=!1),"boolean"!=typeof i.grid.show&&(i.grid.show=!1);var n,l=i.width||t.offsetWidth||300,p=i.height||t.offsetHeight||150,c=l,d=p,f=l/p,u=!1,y={},m=16;for(var x in this.areas={},this.properties={size:i.size},this.callback={},this.mapping={},t.querySelector(".hexmap-inner")||(this.el=document.createElement("div"),this.el.classList.add("hexmap-inner"),t.appendChild(this.el)),this.options={clip:i.label.clip,showgrid:i.grid.show,showlabel:i.label.show,formatLabel:"function"==typeof i.label.format?i.label.format:function(t,e){return t.substr(0,3)},minFontSize:"number"==typeof i.minFontSize?i.minFontSize:4},this.style={default:{fill:"#cccccc","fill-opacity":1,"font-size":m,"stroke-width":1.5,"stroke-opacity":1,stroke:"#ffffff"},highlight:{fill:"#1DD3A7"},grid:{fill:"#aaa","fill-opacity":.1}},i.style)i.style[x]&&(this.style[x]||(this.style[x]={}),i.style[x].fill&&(this.style[x].fill=i.style[x].fill),i.style[x]["fill-opacity"]&&(this.style[x]["fill-opacity"]=i.style[x]["fill-opacity"]),i.style[x]["font-size"]&&(this.style[x]["font-size"]=i.style[x]["font-size"]),i.style[x].stroke&&(this.style[x].stroke=i.style[x].stroke),i.style[x]["stroke-width"]&&(this.style[x]["stroke-width"]=i.style[x]["stroke-width"]),i.style[x]["stroke-opacity"]&&(this.style[x]["stroke-opacity"]=i.style[x]["stroke-opacity"]));this.setFontSize=function(t){for(var e in m=t,this.style.default["font-size"]=m,this.areas)this.areas[e].label&&r(this.areas[e].label,{"font-size":m+"px"});return this},this.setHexSize=function(t){return"number"!=typeof t&&(t=10),t=Math.round(100*t)/100,i.size=t,this.properties.size=t,this.setFontSize(.4*t),this},this.load=function(t,i,s){function a(t,e){g.log("INFO","HexJSON",t),g.setMapping(t),e&&g.updateColours(),"function"==typeof s&&s.call(g,{data:i})}return"function"!=typeof i||s||(s=i,i=""),"string"==typeof t?(this.log("INFO","Loading "+t,i,s),e.ajax(t,{this:this,dataType:"json",success:function(t){a(t)},error:function(e,i){this.log("ERROR","Unable to load "+t,i)}})):"object"==typeof t&&a(t,!0),this};var g=this;function v(t,e,i){return"odd-r"==i&&e%2!=0&&(t+=.5),"even-r"==i&&e%2==0&&(t+=.5),"odd-q"==i&&t%2!=0&&(e+=.5),"even-q"==i&&t%2==0&&(e+=.5),{q:t,r:e}}return window.addEventListener("resize",function(t){g.size()}),this.setHexStyle=function(t){var e,i,s,a,h;if(e=this.areas[t],h=this.style.default,i=JSON.parse(JSON.stringify(h)),s="",e.active&&(i.fill=e.fillcolour),e.hover&&(s+=" hover"),e.selected){for(a in this.style.selected)this.style.selected[a]&&(i[a]=this.style.selected[a]);s+=" selected"}return this.mapping.hexes[t].class&&(s+=" "+this.mapping.hexes[t].class),i.class="hex-cell"+s,r(e.hex,i),e.label&&r(e.label,{class:"hex-label"+s}),e},this.toFront=function(t){if(this.areas[t]){for(var e in this.areas)this.areas[e]&&(this.areas[e].selected&&(a(this.areas[e].hex,n),this.areas[e].label&&a(this.areas[e].label,n)),this.options.clip&&(i=this.areas[e],void 0,h=void 0,s=getComputedStyle(i.hex),h={},s.transform&&(h.transform=s.transform),"none"==h.transform&&(h.transform=""),s["transform-origin"]&&(h["transform-origin"]=s["transform-origin"]),r(i.clip,h)));a(this.areas[t].hex,n),this.areas[t].label&&a(this.areas[t].label,n)}var i,s,h;return this},this.regionToggleSelected=function(t,e){var i,s;if(this.selected=this.selected==t?"":t,(s=this.areas[t]).selected=!s.selected,this.setHexStyle(t),!s.selected&&e)for(i in this.areas)this.areas[i].selected&&(this.areas[i].selected=!1,this.setHexStyle(i));return this},this.regionFocus=function(t){return this.areas[t].hover=!0,this.el.querySelectorAll(".hover").forEach(function(t){t.classList.remove("hover")}),this.setHexStyle(t),this.toFront(t),this},this.regionBlur=function(t){return this.areas[t].hover=!1,this.setHexStyle(t),this},this.regionActivate=function(t){this.areas[t].active=!0,this.setHexStyle(t)},this.regionDeactivate=function(t){this.areas[t].active=!1,this.setHexStyle(t)},this.regionToggleActive=function(t){this.areas[t].active=!this.areas[t].active,this.setHexStyle(t)},this.selectRegion=function(t){for(var e in this.selected=t,this.areas)this.areas[e]&&(t.length>0&&0==e.indexOf(t)?(this.areas[e].selected=!0,this.setHexStyle(e)):(this.areas[e].selected=!1,this.setHexStyle(e)));return this},this.on=function(t,e,i){return"function"!=typeof e||i||(i=e,e=""),"function"!=typeof i?this:(this.callback||(this.callback={}),this.callback[t]={fn:i,attr:e},this)},this.size=function(e,o){this.el.style.height="",this.el.style.width="",r(t,{style:""}),n&&r(n,{width:0,height:0}),e=Math.min(c,t.offsetWidth),this.el.style.height=e/f+"px",this.el.style.width=e+"px",o=Math.min(d,this.el.offsetHeight),n||(r(n=h("svg"),{xmlns:s,version:"1.1",overflow:"visible",viewBox:i.viewBox||"0 0 "+e+" "+o,style:"max-width:100%;",preserveAspectRatio:"xMinYMin meet","vector-effect":"non-scaling-stroke"}),a(n,this.el)),r(n,{width:e,height:o}),r(t,{style:"width:"+e+"px;height:"+o+"px"});var u=e/l;return this.properties.size=i.size*u,l=e,p=o,this.el.style.height="",this.el.style.width="",this},this.initialized=function(){this.create().draw();var e=t.querySelector(".spinner");return e&&e.parentNode.removeChild(e),this},this.create=function(){return n.innerHTML="",this.areas={},u=!1,this},this.setMapping=function(t){var e,s,a;for(e in this.mapping=t,this.properties||(this.properties={x:100,y:100}),s=t.layout.split("-"),this.properties.shift=s[0],this.properties.orientation=s[1],y={r:{min:1e100,max:-1e100},q:{min:1e100,max:-1e100}},this.mapping.hexes)this.mapping.hexes[e]&&((s=v(this.mapping.hexes[e].q,this.mapping.hexes[e].r,this.mapping.layout)).q>y.q.max&&(y.q.max=s.q),s.q<y.q.min&&(y.q.min=s.q),s.r>y.r.max&&(y.r.max=s.r),s.r<y.r.min&&(y.r.min=s.r));return y.q.d=y.q.max-y.q.min,y.r.d=y.r.max-y.r.min,y.q.mid=y.q.min+y.q.d/2,y.r.mid=y.r.min+y.r.d/2,this.range=y,a="r"==this.properties.orientation?Math.min(.5*p/(.75*y.r.d+1),1/Math.sqrt(3)*l/(y.q.d+1)):Math.min(1/Math.sqrt(3)*p/(y.r.d+1),.5*l/(.75*y.q.d+1)),"number"!=typeof i.size&&this.setHexSize(a),this.setSize(),this.initialized()},this.setSize=function(t){return t&&(this.properties.size=t),this.properties.s={cos:Math.round(10*this.properties.size*Math.sqrt(3)/2)/10,sin:.5*this.properties.size},this.properties.s.c=this.properties.s.cos.toFixed(2),this.properties.s.s=this.properties.s.sin.toFixed(2),this},this.drawHex=function(t,e){var i,s,a,r,h,o;return this.properties?(a=this.properties.s.cos,r=this.properties.s.sin,o=v(t,e,this.mapping.layout),"r"==this.properties.orientation?(i=l/2+(o.q-this.range.q.mid)*a*2,s=p/2-(o.r-this.range.r.mid)*r*3):(i=l/2+(o.q-this.range.q.mid)*r*3,s=p/2-(o.r-this.range.r.mid)*a*2),h=[["M",[i=parseFloat(i.toFixed(1)),s]]],"r"==this.properties.orientation?(h.push(["m",[a,-r]]),h.push(["l",[0,2*r,-a,r,-a,-r,0,-2*r,a,-r,a,r]]),h.push(["z",[]])):(h.push(["m",[-r,a]]),h.push(["l",[2*r,0,r,-a,-r,-a,-2*r,0,-r,a]]),h.push(["z",[]])),{array:h,path:function(t){for(var e="",i=0;i<t.length;i++)e+=(t[i][0]?t[i][0]:" ")+(t[i][1].length>0?t[i][1].join(","):" ");return e}(h),x:i,y:s}):this},this.updateColours=function(t){var e,s;for(e in this.mapping.hexes)this.mapping.hexes[e]&&(s=this.style.default.fill,this.mapping.hexes[e].colour&&(s=this.mapping.hexes[e].colour),"string"==typeof i.colours&&(s=i.colours),"function"==typeof t&&(s=t.call(this,e)),this.areas[e].fillcolour=s,this.setHexStyle(e));return this},this.draw=function(){var t,e,i,s;function l(t,e){if(t.data.hexmap.callback[e]){for(var i in t.data.hexmap.callback[e].attr)t.data.hexmap.callback[e].attr[i]&&(t.data[i]=t.data.hexmap.callback[e].attr[i]);if("function"==typeof t.data.hexmap.callback[e].fn)return t.data.hexmap.callback[e].fn.call(t.data.this||this,t)}}this.range=y;var p,c,d,f,m,x=function(t){t.data.hexmap.regionFocus(t.data.region),l(t,"mouseover")},g=function(t){l(t,"mouseout")},v=function(t){t.data.hexmap.regionFocus(t.data.region),l(t,"click")};if((this.options.showgrid||this.options.clip)&&!this.grid){for(this.grid=h("g"),e=y.q.min-1;e<=y.q.max+1;e++)for(t=y.r.min-1;t<=y.r.max+1;t++)i=this.drawHex(e,t),this.options.showgrid&&(r(s=h("path"),{d:i.path,class:"hex-grid","data-q":e,"data-r":t,fill:this.style.grid.fill||"","fill-opacity":this.style.grid["fill-opacity"]||.1,stroke:this.style.grid.stroke||"#aaa","stroke-opacity":this.style.grid["stroke-opacity"]||.2}),o("mouseover",{type:"grid",hexmap:this,data:{r:t,q:e}},x),o("mouseout",{type:"grid",hexmap:this,me:p,data:{r:t,q:e}},g),o("click",{type:"grid",hexmap:this,me:p,data:{r:t,q:e}},v),a(s,this.grid));a(this.grid,n)}for(t in 5e4,8e4,p=this,a(c=h("defs"),n),this.mapping.hexes)this.mapping.hexes[t]&&(i=this.drawHex(this.mapping.hexes[t].q,this.mapping.hexes[t].r),u||((d=h("path")).innerHTML="<title>"+(this.mapping.hexes[t].n||t)+"</title>",r(d,{d:i.path,class:"hex-cell","transform-origin":i.x+"px "+i.y+"px","data-q":this.mapping.hexes[t].q,"data-r":this.mapping.hexes[t].r,id:"hex-"+t}),n.appendChild(d),this.areas[t]={hex:d,selected:!1,active:!0},o("mouseover",d,{type:"hex",hexmap:this,region:t,data:this.mapping.hexes[t],pop:this.mapping.hexes[t].p},x),o("mouseout",d,{type:"hex",hexmap:this,region:t,me:this.areas[t]},g),o("click",d,{type:"hex",hexmap:this,region:t,me:this.areas[t],data:this.mapping.hexes[t]},v),this.options.showlabel&&this.style.default["font-size"]>=this.options.minFontSize&&(this.options.clip&&(this.areas[t].clip=h("clipPath"),this.areas[t].clip.setAttribute("id","hex-clip-"+t),r(m=h("path"),{d:i.path,"transform-origin":i.x+"px "+i.y+"px"}),a(m,this.areas[t].clip),a(this.areas[t].clip,c)),(f=h("text")).innerHTML=this.options.formatLabel(this.mapping.hexes[t].n,{x:i.x,y:i.y,hex:this.mapping.hexes[t],size:this.properties.size,"font-size":this.style.default["font-size"]}),r(f,{x:i.x,y:i.y,id:"hex-"+t+"-label","transform-origin":i.x+"px "+i.y+"px","dominant-baseline":"central","clip-path":"url(#hex-clip-"+t+")","data-q":this.mapping.hexes[t].q,"data-r":this.mapping.hexes[t].r,class:"hex-label","text-anchor":"middle","font-size":this.style.default["font-size"]+"px",title:this.mapping.hexes[t].n||t,_region:t}),n.appendChild(f),this.areas[t].label=f,this.areas[t].labelprops={x:i.x,y:i.y},o("mouseover",f,{type:"hex",hexmap:this,region:t,data:this.mapping.hexes[t],pop:this.mapping.hexes[t].p},x),o("mouseout",f,{type:"hex",hexmap:this,region:t,me:this.areas[t]},g),o("click",f,{type:"hex",hexmap:this,region:t,me:this.areas[t],data:this.mapping.hexes[t]},v))),this.setHexStyle(t),r(this.areas[t].hex,{stroke:this.style.default.stroke,"stroke-opacity":this.style.default["stroke-opacity"],"stroke-width":this.style.default["stroke-width"],title:this.mapping.hexes[t].n,"data-regions":t,style:"cursor: pointer;"}));return u=!0,this},this.size(),i.hexjson&&this.load(i.hexjson,i.ready),this}e.ready||(e.ready=function(t){"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)}),e.ajax||(e.ajax=function(t,e){e||(e={});var i=new XMLHttpRequest;return"responseType"in i&&e.dataType&&(i.responseType=e.dataType),i.open(e.method||"GET",t+(e.cache?"?"+Math.random():""),!0),i.onload=function(i){if(this.status>=200&&this.status<400){var s=this.response;"function"==typeof e.success&&e.success.call(e.this||this,s,{url:t,data:e,originalEvent:i})}else"function"==typeof e.error&&e.error.call(e.this||this,i,{url:t,data:e})},"function"==typeof e.error&&(i.onerror=function(i){e.error.call(e.this||this,i,{url:t,data:e})}),i.send(),this}),e.hexmap=function(t,e){return new i(t,e)};var s="http://www.w3.org/2000/svg";function a(t,e){return e.appendChild(t)}function r(t,e){for(var i in e)e[i]&&t.setAttribute(i,e[i]);return t}function h(t){return document.createElementNS(s,t)}function o(t,e,i,s){e&&(e.length||(e=[e]),"function"==typeof s&&e.forEach(function(e){e.addEventListener(t,function(t){t.data=i,s.call(i.this||this,t)})}))}t.ODI=e}(window||this);